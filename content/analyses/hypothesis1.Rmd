---
title: "Hypothesis 1"
description: "The use of the term “diversity” and related terminology has increased in biomedical abstracts since 1990."
output: html_document
weight: 1
---

Over the past several years, social scientists have noted that the discourse of "diversity" is expanding in use across various social contexts ([Berrey 2015](https://www.youtube.com/watch?time_continue=96&v=AyZJdEfYUjw&feature=emb_logo)). In this project, we are interested in measuring how often diversity and its various metonyms are mentioned in biomedical research over the three decades (1990-2017). Our first working hypothesis is that: 

* The use of the term 'diversity' and its related terminology has increased in biomedical abstracts since 1990. 

To test Hypothesis 1, we concatenated sets of diversity-related terms into 11 categories (aging, ancestry, cultural, diversity, genetic, minority, population, race/ethnicity, sex/gender, sexuality, and social class) and then used natural language processing to quantify the (1) variation of raw term counts over time and (2) the proportion of publications that a set of terms are used in each year. For a full list of terms in each category, see Supplementary Table 1A at the end of this page. 

### Raw Growth in Biomedical Abstracts

The first two plots show how these sets of terms have changed in a sample of ~59,000 biomedical abstracts. 

```{r prereqs_part1, message = FALSE, results = FALSE, echo=FALSE, warning=FALSE}
rm(list = ls())

for (pkg in c("tidyverse", "igraph", "tidytext", "ggplot2", "DT",
              "grid", "gridExtra", "reshape2", "extrafont", "data.table", "maditr",
              "plotly", "stringi", "networkD3")) {library(pkg, character.only = TRUE)}

setwd("~/Documents/Diversity/Data")
# loading the .csv file 
biomed_text_data <- read_csv("biomedical_corpus.csv") %>% 
  rowid_to_column(var = "id") %>% 
  rename(authors = AU, title = TI, publication = SO, #author_keywords = DE,
         abstract = AB, references = CR, year = PY, times_cited = TC) %>% 
  select(id, authors, title, year, publication, abstract, references, year, times_cited) %>% 
  drop_na(abstract) %>% 
# filtering 2018 articles because they seem to be incomplete 
  filter(year != "2018") 

# tokenizing the abstract data into words 
biomed_abstract_data <- biomed_text_data %>% 
  unnest_tokens(word, abstract) #%>% anti_join(stop_words)

# adding custom set of stopwords 
my_stopwords <- tibble(word = c(as.character(1:14), "[0-9]", 
                                "rights", "reserved", "copyright", "elsevier", 
                                "women.recommendations", 
                                "cs.man.ac.uk", "sexes.please", "movements.baby"))

biomed_abstract_data <- biomed_abstract_data %>% 
  anti_join(my_stopwords)
# most frequent word count in abstracts 
#biomed_abstract_data %>%
#  count(word, sort = TRUE)

# lets draw all of our strings from the diversity_dictionary (divictionary)
setwd("~/Documents/Diversity/Data")
divictionary <- read_csv("diversity_project - h1_dictionary.csv") 

general_pop_terms <- biomed_abstract_data %>% 
  as.data.table() %>%
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$aging), "zqx)\\b"), collapse = "|")), 
         yes = "aging", no = word)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$ancestry), "zqx)\\b"), collapse = "|")), 
         yes = "ancestry", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$cultural), "zqx)\\b"), collapse = "|")), 
         yes = "cultural", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$diversity), "zqx)\\b"), collapse = "|")), 
         yes = "diversity", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$genetic), "zqx)\\b"), collapse = "|")), 
         yes = "genetic", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$social_class), "zqx)\\b"), collapse = "|")), 
         yes = "socio-economic", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$minority), "zqx)\\b"), collapse = "|")), 
         yes = "minority", no = term)) %>%
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$population), "zqx)\\b"), collapse = "|")), 
         yes = "population", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$race_ethnicity), "zqx)\\b"), collapse = "|")), 
         yes = "race/ethnicity", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$sex_gender), "zqx)\\b"), collapse = "|")), 
         yes = "sex/gender", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$sexuality), "zqx)\\b"), collapse = "|")), 
         yes = "sexuality", no = term)) %>% 
  dt_mutate(di_aging = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(aging)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_ancestry = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(ancestry)\\b"), yes = 1, no = 0)) %>% 
  dt_mutate(di_cultural = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(cultural)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_class = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(socio-economic)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_diversity = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(diversity)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_genetic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(genetic)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_minority = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(minority)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(population)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_racial = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(race/ethnicity)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_sexgender = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sex/gender)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_sexuality = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sexuality)\\b"), yes = 1, no = 0)) 

# total articles each year 
gen_pop_prc_counts <- biomed_text_data %>% 
  group_by(year) %>% 
  count(year) %>% 
  ungroup() %>% 
  rename(total = n) 

# articles with term mentioned each year 
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_racial == 1) %>% #racial 
  group_by(year) %>% 
  summarise(cnt_racial = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>%  
  mutate(prc_racial = round(cnt_racial / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_cultural == 1) %>% #cultural
  group_by(year) %>% 
  summarise(cnt_cultural = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_cultural = round(cnt_cultural / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_population == 1) %>% #population
  group_by(year) %>% 
  summarise(cnt_population = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2)) 
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_ancestry == 1) %>% # ancestry
  group_by(year) %>% 
  summarise(cnt_ancestry = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_ancestry = round(cnt_ancestry / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_diversity == 1) %>% #diversity
  group_by(year) %>% 
  summarise(cnt_diversity = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_diversity = round(cnt_diversity / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_genetic == 1) %>% #genetic
  group_by(year) %>% 
  summarise(cnt_genetic = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_genetic = round(cnt_genetic / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_sexgender == 1) %>% #sex/gender
  group_by(year) %>% 
  summarise(cnt_sexgender = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_sexgender = round(cnt_sexgender / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_sexuality == 1) %>% # sexuality
  group_by(year) %>% 
  summarise(cnt_sexuality = n_distinct(id)) %>%  
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_sexuality = round(cnt_sexuality / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_aging == 1) %>% # aging
  group_by(year) %>% 
  summarise(cnt_aging = n_distinct(id)) %>%  
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_aging = round(cnt_aging / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_class == 1) %>% # class
  group_by(year) %>% 
  summarise(cnt_class = n_distinct(id)) %>%  
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_class = round(cnt_class / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_minority == 1) %>% # minority
  group_by(year) %>% 
  summarise(cnt_minority = n_distinct(id)) %>%  
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_minority = round(cnt_minority / total * 100, digits = 2))
```

```{r figure 1a, echo=FALSE}
figure_1A <- general_pop_terms %>% 
  # grouping by year and filter relevant population terms 
  group_by(year) %>% count(term, sort = TRUE) %>% ungroup() %>% 
  filter(term == "diversity" | term == "cultural" | term == "genetic" | term == "population" | 
           term == "sex/gender" | term == "sexuality" | term == "aging" | term == "minority" |
           term == "race/ethnicity" | term == "ancestry" | term == "socio-economic") %>% 
  # graphing terms over time 
  ggplot() + 
  geom_line(aes(y = n, x = year, colour = term), size = 1.3, stat="identity") + 
  theme_minimal() +
  labs(title = "        Figure 1A. Total Growth of Diversity-Related \n Terminology in Biomedical Sample (1990-2017)",
       color =  "Term") + 
  #scale_linetype_manual( values=linetype) +
  ylab("Term Count") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        legend.position = "none",
        legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(labels=c("aging",  "ancestry", "cultural", "diversity","genetic", "minority",
                              "population","race/ethnicity","sex/gender","sexuality","socio-economic"),
                     values=c("#f2be00", "#000000",  "#61B329", "#3B9AB2", "#E86F00", "#d23ccc", 
                              "#1b7524", "#00468b", "#CC0000", "#ff8396", "#800080")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

Figure 1A shows the growth in the raw word frequencies of diversity-related terms from 1990-2017. This plot shows that the term diversity has consistently grown over time (from only 2 mentions in 1992 to 381 in 2017). This trend offers preliminary support for H1, but is only one small part of how diversity-related terms are channging in use. Overall, most of the terms in this graph have increased, but we see the most notable growth in terms related to sex/gender and aging research. While this growth is in part because scientists now have a larger dictionary of terms to describe sexed/gendered and aging populations, the focus on these topics is not simply a function of a more comprehensive vocabulary. Supplementary Table 1B provides the totals of top terms used in the aging, class, sex/gender, and sexualities categories, showing that, for example, the use of "women" would have the fifth highest total in the final year of this plot. Figure 1A also shows that terms like population, genetic, and cultural have also risen notably over time while terms associated with race/ethnicity, minority, class, sexuality, social class, and ancestry have all grown at a slower pace than the set of diversity terms.

### Proportional Growth in Biomedical Abstracts

To normalize for the growth of overall publications, we look at change in the proportion of available abstracts.

```{r figure 1b, echo=FALSE}
# graphing terms over time 
figure_1B <- gen_pop_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_aging, x = year, colour = "aging"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_ancestry, x = year, colour = "ancestry"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_class, x = year, colour = "socio-economic"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_cultural, x = year, colour = "cultural"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_diversity, x = year, colour = "diversity"), size = 1.3, stat="identity", linetype = "solid") +
  #geom_line(aes(y = prc_ethnic, x = year, colour = "ethnic"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_genetic, x = year, colour = "genetic"), size = 1.3, stat="identity") +
  #geom_line(aes(y = prc_linguistic, x = year, colour = "linguistic"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_minority, x = year, colour = "minority"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_population, x = year, colour = "population"), size = 1.3, stat="identity") +
  #geom_line(aes(y = prc_racial, x = year, colour = "racial"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_racial, x = year, colour = "race/ethnicity"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_sexgender, x = year, colour = "sex/gender"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_sexuality, x = year, colour = "sexuality"), size = 1.3, stat="identity") +
  labs(title = "        Figure 1B. Proportional Growth Diversity-Related \n Terminology in Biomedical Sample (1990-2017)",
       color =  "Term") + 
  theme_minimal() +
  ylab("Proportion of Abstracts") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        legend.position = "none",
        #legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(labels=c("aging",  "ancestry", "cultural", "diversity","genetic", "minority",
                              "population","race/ethnicity","sex/gender","sexuality","socio-economic"),
                     values=c("#f2be00", "#000000",  "#61B329", "#3B9AB2", "#E86F00", "#d23ccc", 
                              "#1b7524", "#00468b", "#CC0000", "#ff8396", "#800080")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

While the raw totals suggested that diversity-related terms are rising, the proportions outlined in Figure 1B suggest that the sets of diversity-related terms has changed relatively little over time. For example, the terms associated with aging, ancestry, minority, sex/gender, sexualities, social class, and race/gender have stayed relatively stable over time. Perhaps the most interesting trend is the sex/gender line, which rises from 8% to 12% of articles from 1990 to 1996 before returning to around ~8% in 2005. In contrast, the terms associated with population, genetic, class, and diversity have all steadily increased from their baseline in 1990. 

### Raw Growth in Diversity Abstracts

The previous plots demonstrate that some, but not all, diversity terms have generally risen in biomedical research. However, we were also interested in understanding how these terms changed in the context of biomedical research that focuses specifically on the topic of diversity. 

```{r prereqs_pt2, message = FALSE, results = FALSE, echo=FALSE, warning=FALSE}
setwd("~/Documents/Diversity/Data")
# loading the .csv file 
text_data <- read_csv("diversity_corpus.csv") %>% 
  drop_na(abstract) %>% 
# filtering 2018 articles because they seem to be incomplete 
  filter(year != "2018") 
# tokenizing the abstract data into words 
abstract_data <- text_data %>% 
  unnest_tokens(word, abstract) %>% 
  anti_join(stop_words)

abstract_data <- abstract_data %>% 
  anti_join(my_stopwords)

# lets draw all of our strings from the diversity_dictionary (divictionary)
setwd("~/Documents/Diversity/Data")
divictionary <- read_csv("diversity_project - h1_dictionary.csv") 

# recoding race*, ethnicity* and cultural* terminology
general_pop_terms_div <- abstract_data %>% 
  as.data.table() %>%
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$aging), "zqx)\\b"), collapse = "|")), 
         yes = "aging", no = word)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$ancestry), "zqx)\\b"), collapse = "|")), 
         yes = "ancestry", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$cultural), "zqx)\\b"), collapse = "|")), 
         yes = "cultural", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$diversity), "zqx)\\b"), collapse = "|")), 
         yes = "diversity", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$genetic), "zqx)\\b"), collapse = "|")), 
         yes = "genetic", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$minority), "zqx)\\b"), collapse = "|")), 
         yes = "minority", no = term)) %>%
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$population), "zqx)\\b"), collapse = "|")), 
         yes = "population", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$race_ethnicity), "zqx)\\b"), collapse = "|")), 
         yes = "race/ethnicity", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$sex_gender), "zqx)\\b"), collapse = "|")), 
         yes = "sex/gender", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$sexuality), "zqx)\\b"), collapse = "|")), 
         yes = "sexuality", no = term)) %>% 
  dt_mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$social_class), "zqx)\\b"), collapse = "|")), 
         yes = "socio-economic", no = term)) %>% 
  dt_mutate(di_aging = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(aging)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_ancestry = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(ancestry)\\b"), yes = 1, no = 0)) %>% 
  dt_mutate(di_cultural = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(cultural)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_diversity = ifelse(test = str_detect(string = term, 
                       pattern = "diversity"), yes = 1, no = 0)) %>%
  dt_mutate(di_genetic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(genetic)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_minority = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(minority)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(population)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_racial = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(race/ethnicity)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_sexgender = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sex/gender)\\b"), yes = 1, no = 0)) %>%
  dt_mutate(di_sexuality = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sexuality)\\b"), yes = 1, no = 0)) %>% 
  dt_mutate(di_class = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(socio-economic)\\b"), yes = 1, no = 0)) 

# total articles each year 
gen_pop_prc_counts_div <- text_data %>% 
  group_by(year) %>% 
  count(year) %>% 
  ungroup() %>% 
  rename(total = n) 
# articles with term mentioned each year 
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_racial == 1) %>% 
  group_by(year) %>% summarise(cnt_racial = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>%  
  mutate(prc_racial = round(cnt_racial / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_cultural == 1) %>% 
  group_by(year) %>% summarise(cnt_cultural = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_cultural = round(cnt_cultural / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_population == 1) %>% 
  group_by(year) %>% summarise(cnt_population = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_ancestry == 1) %>% 
  group_by(year) %>% summarise(cnt_ancestry = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_ancestry = round(cnt_ancestry / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_diversity == 1) %>% 
  group_by(year) %>% summarise(cnt_diversity = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_diversity = round(cnt_diversity / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_genetic == 1) %>% 
  group_by(year) %>% summarise(cnt_genetic = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_genetic = round(cnt_genetic / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_sexgender == 1) %>% 
  group_by(year) %>% summarise(cnt_sexgender = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_sexgender = round(cnt_sexgender / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_sexuality == 1) %>% 
  group_by(year) %>% summarise(cnt_sexuality = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_sexuality = round(cnt_sexuality / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_aging == 1) %>% 
  group_by(year) %>% summarise(cnt_aging = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_aging = round(cnt_aging / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_minority == 1) %>% 
  group_by(year) %>% summarise(cnt_minority = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_minority = round(cnt_minority / total * 100, digits = 2))
gen_pop_prc_counts_div <- general_pop_terms_div %>% filter(di_class == 1) %>% 
  group_by(year) %>% summarise(cnt_class = n_distinct(pubmed_id)) %>% 
  right_join(gen_pop_prc_counts_div, by = "year") %>% 
  mutate(prc_class = round(cnt_class / total * 100, digits = 2))
```

```{r figure 1c, echo=FALSE}
#graphs 
figure_1C <- gen_pop_prc_counts_div %>% 
  ggplot() + 
  geom_line(aes(y = cnt_aging, x = year, colour = "aging"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_ancestry, x = year, colour = "ancestry"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_cultural, x = year, colour = "cultural"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_diversity, x = year, colour = "diversity"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_genetic, x = year, colour = "genetic"), 
            size = 1.3, stat="identity", linetype = "solid") +
  #geom_line(aes(y = cnt_lingustic, x = year, colour = "linguistic"), 
  #          size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_minority, x = year, colour = "minority"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_population, x = year, colour = "population"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = cnt_racial, x = year, colour = "race/ethnicity"), 
            size = 1.3, stat="identity", linetype = "solid") + 
  geom_line(aes(y = cnt_sexgender, x = year, colour = "sex/gender"), 
            size = 1.3, stat="identity", linetype = "solid") + 
  geom_line(aes(y = cnt_sexuality, x = year, colour = "sexuality"), 
            size = 1.3, stat="identity", linetype = "solid") + 
  geom_line(aes(y = cnt_class, x = year, colour = "socio-economic"), 
            size = 1.3, stat="identity", linetype = "solid") +
  theme_minimal() +
  labs(title = "Figure 1C. Total Growth of Diversity-Related \n Terminology in Diversity Sample (1990-2017)",
       color =  "Term") + 
  ylab("Term Count") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        legend.position = "none",
        legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(labels=c("aging",  "ancestry", "cultural", "diversity","genetic", "minority",
                              "population","race/ethnicity","sex/gender","sexuality","socio-economic"),
                     values=c("#f2be00", "#000000",  "#61B329", "#3B9AB2", "#E86F00", "#d23ccc", 
                              "#1b7524", "#00468b", "#CC0000", "#ff8396", "#800080")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

Figure 1C one again shows consistent growth in the raw word frequencies from 1990-2017. For example, the terms diversity, population, and genetic exhibit a 12-fold-to-15-fold increase over that time. Sex/gender, race/ethnicity, and aging also increase at similar rates (around a 21 to 22-fold increase) while ancestry, sexuality and most of the other terms display minimal variation over time.

### Proportional Growth in Diversity Abstracts

```{r figure 1d, echo=FALSE}
# graphing terms over time 
figure_1D <- gen_pop_prc_counts_div %>% ggplot() + 
  geom_line(aes(y = prc_aging, x = year, colour = "aging"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_ancestry, x = year, colour = "ancestry"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_cultural, x = year, colour = "cultural"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_diversity, x = year, colour = "diversity"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_genetic, x = year, colour = "genetic"), 
            size = 1.3, stat="identity", linetype = "solid") +
  #geom_line(aes(y = prc_linguistic, x = year, colour = "linguistic"), 
  #          size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_minority, x = year, colour = "minority"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_population, x = year, colour = "population"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_racial, x = year, colour = "race/ethnicity"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_sexgender, x = year, colour = "sex/gender"), 
            size = 1.3, stat="identity", linetype = "solid") +
  geom_line(aes(y = prc_sexuality, x = year, colour = "sexuality"), 
            size = 1.3, stat="identity", linetype = "solid") +
  labs(title = "Figure 1D. Proportional Growth in Diversity-Related \n Terminology in Diversity Sample (1990-2017)",
       color =  "Term") + 
  theme_minimal() +
  ylab("Proportion of Abstracts") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        legend.position = "none",
        #legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(labels=c("aging",  "ancestry", "cultural", "diversity","genetic", "minority",
                              "population","race/ethnicity","sex/gender","sexuality","socio-economic"),
                     values=c("#f2be00", "#000000",  "#61B329", "#3B9AB2", "#E86F00", "#d23ccc", 
                              "#1b7524", "#00468b", "#CC0000", "#ff8396", "#800080")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

Figure 1D shows proportional growth, telling a slightly different story that Figure 1C, with several nonlinear trends occurring over our period of analysis. First, the term diversity arises in about 75% of abstracts, dropping to 66% at its lowest point in 1996 before increasing to 89% of abstracts in 2017. As a reminder, this sample was generated by searching on the term diversity in abstracts, titles, and keywords. Thus, our sampling method helps explain both why the term diversity is so high relative to others in the dataset as well as why the term does not arise in each and every abstract. Figure 1D also demonstrates that the use of population, genetic, and sex/gender all increase by about 7-8%. On the other hand, the terms cultural, ancestry, and race/ethnicity all follow parabolic patterns, ascending through the mid-2000s before descending to present day. For instance, the term cultural nearly doubles in usage from 1990 to 2006 before dropping to near its baseline in 2017. Similarly, race/ethnicity rises from being present in 3.2% to nearly 10% of abstracts in 2004 before dropping to 6.7% in 2017. Ancestry follows a similar trend rising from 1.4% in 1990 to 4% in 2009 before declining to 2.6% in 2017. 

### Main Takeaways 

Overall, our results provide support for the notion that the use of the term "diversity" is increasing in the biomedical abstracts, but when taken on whole it seems that this growth is quite modest. The raw term frequencies suggest that diversity-related terminology has grown dramatically over time, but the proportional analyses temper these findings by showing that some trends, like sex/gender and race/ethnicity, have actually declined in recent years. Future work will need to examine what social, political and economic factors may have contributed to these declines. 

### Appendices 

Here is a list of the terms in each category analyzed above. You can scroll through each category or use the search tool to see if a term of interest was used in the analyses.

```{r, echo = FALSE}
first_table <- divictionary %>% select(aging, ancestry, cultural, diversity, genetic)
first_table[is.na(first_table)] <- ""
datatable(first_table, caption = 'Supplementary Table 1A: Dictionary Categories for Hypothesis 1 Testing', rownames = FALSE)
```
```{r, echo = FALSE}
second_table <- divictionary %>% select(minority, population, race_ethnicity, sex_gender, sexuality)
second_table[is.na(second_table)] <- ""
datatable(second_table, rownames = FALSE)
```

```{r biomedical_wordfreqs, echo = FALSE}
aging_terms <- general_pop_terms %>% 
  filter(di_aging == 1 & year == 2017) %>% 
  #group_by(year) %>% 
  count(word) %>% 
  arrange(-n) %>% 
  rename(aging_term = word, aging_n = n) %>% 
  rowid_to_column(var = "rowname") 
sexgender_terms <- general_pop_terms %>% 
  filter(di_sexgender == 1 & year == 2017) %>% 
  #group_by(year) %>% 
  count(word) %>% 
  arrange(-n) %>% 
  rename(sexgender_term = word, sexgender_n = n) %>% 
  rowid_to_column(var = "rowname") 
sexualities_terms <- general_pop_terms %>% 
  filter(di_sexuality == 1 & year == 2017) %>% 
  count(word) %>% 
  arrange(-n) %>% 
  rename(sexualities_term = word, sexualities_n = n) %>% 
  rowid_to_column(var = "rowname")  
class_terms <- general_pop_terms %>% 
  filter(di_class == 1 & year == 2017) %>% 
  count(word) %>% 
  arrange(-n) %>% 
  rename(class_term = word, class_n = n) %>% 
  rowid_to_column(var = "rowname")
joined_tables <- full_join(aging_terms, class_terms, by = "rowname")
joined_tables <- full_join(joined_tables, sexgender_terms, by = "rowname")
joined_tables <- full_join(joined_tables, sexualities_terms, by = "rowname") %>% select(-rowname)
joined_tables[is.na(joined_tables)] <- ""
datatable(joined_tables, 
          colnames = c('Aging', 'Total', 'Class', 'Total','Sex/Gender', 'Total', 'Sexualities', 'Total'),
          caption = 'Supplementary Table 1B: 2017 Totals for Aging, Class, Sex/Gender, and Sexualities Category (Biomedical Sample)', 
          rownames = FALSE)
```

### Sensitivity Checks 

While most of our terms are specific to each category in which they are listed. However, the term "minority" is one term that we were concerned about producing false positive results. As a sensitivity check, we found that in the large majority of cases minority was being used alongside diversity, racial, sex/gender, or sexuality terms in our dataset. However, it should be noted that there remains a 2-9% false positive rate in any given year when the term minority does not clearly relate to diversity research. While we considered removing these instances from our dataset, we decided to maintain consistency across our datasets noting that there is likely some noise in almost all categories and altering one category is likely to create problems for accurate comparison across the categories in the plot. The abstracts listed in the following table are examples of the false-positives included in the minority category.

```{r h1_sensitivity_minority, echo=FALSE}
minority_abstracts <- general_pop_terms %>% 
  group_by(id) %>% 
  summarise(sum_minority = sum(di_minority), 
            sum_diversity = sum(di_diversity),
            sum_racial = sum(di_racial),
            sum_sexgender = sum(di_sexgender),
            sum_sexuality = sum(di_sexuality),) %>% 
  filter(sum_minority >= 1) %>% 
  inner_join(biomed_text_data, by = "id") %>% 
  mutate(abstract = tolower(abstract)) %>% 
  select(id, sum_minority, sum_diversity, sum_racial, sum_sexgender, sum_sexuality, abstract, year) %>% 
  filter(sum_diversity == 0 & sum_racial == 0 & sum_sexgender == 0 & sum_sexuality == 0) %>% 
  filter(!grepl("marginalized|minorities|under-represented|underrepresented|african-american|african|caucasian|white|asian|asian-american|native|hispanic|latino", 
                abstract))
minority_table <- minority_abstracts %>% select(year, abstract)
#sum(general_pop_terms$di_minority)
#sum(minority_abstracts$sum_minority)
#minority_abstracts %>% group_by(year) %>% count(year)
#write_csv(minority_abstracts, "minority_abstracts.csv")
datatable(minority_table, colnames = c('Year', 'Abstract'),
          caption = 'Supplementary Table 1C: Examples of False-Positive Uses of Minority in Biomedical Sample', options = list(pageLength = 5, dom = 'tip'), rownames = FALSE)
```