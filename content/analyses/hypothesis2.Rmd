---
title: "Hypothesis 2"
description: "The use of population terminology has increased in biomedical abstracts since 1990."
output: html_document
---

```{r prereqs, message = FALSE, results = FALSE, echo=FALSE}
rm(list = ls())

for (pkg in c("tidyverse", "igraph", "tidytext", "ggplot2", 
              "grid", "gridExtra", "reshape2", "extrafont",
               "plotly", "stringi", "networkD3")) {library(pkg, character.only = TRUE)}

setwd("~/Documents/Diversity/Data")
# loading the .csv file 
text_data <- read_csv("diversity_corpus.csv") %>% 
# filtering 2018 articles because they seem to be incomplete 
  filter(year != "2018") 
# tokenizing the abstract data into words 
abstract_data <- text_data %>% 
  unnest_tokens(word, abstract) %>% 
  anti_join(stop_words)
# adding custom set of stopwords 
my_stopwords <- tibble(word = c(as.character(1:14), "[0-9]", 
                                "rights", "reserved", "copyright", "elsevier"))
abstract_data <- abstract_data %>% anti_join(my_stopwords); rm(my_stopwords)

# lets draw all of our strings from the diversity_dictionary
setwd("~/Documents/Diversity/Data")
divictionary <- read_csv("diversity_project - h1_categories.csv") 

# pulling our list of population
all_pop_terms <- read_csv("population_terms.csv") 
all_pop_terms <- paste(c("\\b(?i)(zcx", all_pop_terms$term, "zxc)\\b"), collapse = "|")
```

Next, we return to the diversity corpus to test Hypothesis 2. Here, we examine whether the use of population terminology has grown in biomedical abstracts over the past three decades. To do this, we build on Panofsky and Blissâ€™s (2017) exploration of how research scientists enact population differences using a polyvocality of terms, including geographic classifications like continents and countries. Drawing from their coding schema, we developed a list of over 2,100 terms that correspond to national, continental, racial, ethnic, and other general population groupings (e.g. terms like race, ethnicity and population) that biomedical researchers could use to enact population differences. 

```{r figure 2a, echo=FALSE}
figure_2A <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = word, 
                       pattern = all_pop_terms), 
                       yes = "all population terms", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$race_ethnicity), "zqx)\\b"), collapse = "|")), 
         yes = "race/ethnicity", no = term)) %>% 
  group_by(year) %>% count(term, sort = TRUE) %>% ungroup() %>% 
  filter(term == "diversity" | term == "race/ethnicity" | 
         term == "population" | term == "all population terms") %>% 
  ggplot() + geom_line(aes(y = n, x = year, colour = term), size = 1.3, stat="identity") + 
  theme_minimal() +
  labs(title = "     Figure 2A. Total Growth of \n Collapsed Diversity Terms (1990-2017)",
       color =  "Term") + 
  #scale_linetype_manual( values=linetype) +
  ylab("Term Count") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        legend.position = "none",
        legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(values=c("#E21F00", "#3B9AB2", "#61B329", "#E2B306")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

Figure 2A shows a census of all population terms clustered together. This graph demonstrates that, when taken together as a whole, the growth of population terminology is so dramatic that it surpasses the total number of times that the term diversity, which the corpus was sampled on, was mentioned. This evidence shows clear support for Hypothesis 2.

```{r figure 2b, echo=FALSE}
# proportional graph 

all_pop_terms_trends <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = all_pop_terms), 
                       yes = "all population terms", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = word, 
         pattern = paste(c("\\b(?i)(zqx", na.omit(divictionary$race_ethnicity), "zqx)\\b"), collapse = "|")), 
         yes = "race/ethnicity", no = term)) %>%  
  mutate(population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b((?<!all )population)\\b"), yes = 1, no = 0)) %>% 
  mutate(all_pop_terms = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(all population terms)\\b"), yes = 1, no = 0)) %>% 
  mutate(diversity = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(diversity)\\b"), yes = 1, no = 0)) %>% 
  mutate(race_ethnicity = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(race/ethnicity)\\b"), yes = 1, no = 0)) 
# total articles each year 
all_pop_prc_counts <- text_data %>% group_by(year) %>% 
  count(year) %>% ungroup() %>% rename(total = n) 
# articles with term mentioned each year 
all_pop_prc_counts <- all_pop_terms_trends %>% filter(population == 1) %>% 
  group_by(year) %>% summarise(cnt_population = n_distinct(pubmed_id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2))
all_pop_prc_counts <- all_pop_terms_trends %>% filter(all_pop_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_all_pop = n_distinct(pubmed_id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_all_pop = round(cnt_all_pop / total * 100, digits = 2))
all_pop_prc_counts <- all_pop_terms_trends %>% filter(diversity == 1) %>% 
  group_by(year) %>% summarise(cnt_diversity = n_distinct(pubmed_id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_diversity = round(cnt_diversity / total * 100, digits = 2))
all_pop_prc_counts <- all_pop_terms_trends %>% filter(race_ethnicity == 1) %>% 
  group_by(year) %>% summarise(cnt_race_ethnicity = n_distinct(pubmed_id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_race_ethnicity = round(cnt_race_ethnicity / total * 100, digits = 2))

# graphing the patterns over time
figure_2B <- all_pop_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_population, x = year, colour = "population"), size = 1.3, stat="identity") +
  geom_line(aes(y = prc_all_pop, x = year, colour = "all population terms"), size = 1.3, stat="identity") + 
  geom_line(aes(y = prc_diversity, x = year, colour = "diversity"), size = 1.3, stat="identity") + 
  geom_line(aes(y = prc_race_ethnicity, x = year, colour = "race/ethnicity"), size = 1.3, stat="identity") + 
  labs(title = "    Figure 2B. Proportional Growth of \n Collapsed Diversity Terms (1990-2017)",
       color =  "Term") + 
  theme_minimal() +
  ylab("Proportion of Articles") +
  theme(axis.title.x = element_blank(), 
        #axis.title.y = element_blank(), 
        #legend.position = "none",
        legend.box = "vertical", 
        legend.position = "none",
        legend.title = element_text(size = 10, hjust = 0.5, face="bold"),
        plot.title = element_text(size=12, hjust = 0.5)) +
  scale_color_manual(values=c("#E21F00", "#3B9AB2", "#61B329", "#E2B306")) +
  scale_x_continuous(limits = c(1990, 2017),
                     breaks = c(1990, 1995, 2000, 2005, 2010, 2015)); ggplotly()
```

When looking at the proportions in Figure 2B, the aggregated population terms occur in roughly 20% of the literature in 1990, which increases to about 42% of all abstracts in 2017. At first glance, readers might be surprised to see that the population terms were mentioned in a smaller proportion of articles than the term diversity even though diversity has a lower overall count than the population terms in Figure 2A. We remind the reader that Figure 2A includes the use of multiple terms in each abstract while Figure 2B only factors in whether or not a term was used in the abstract. In other words, Figure 2A shows that researchers use multiple population terms in each abstract, suggesting that scientists are comparing two or more populations in each publication and/or that researchers implement multiple terms to describe the same population. These two forms of "ambiguity" will need to be further examined in future research. 

### Main Takeaway 

When taken as a whole, population terminology has grown dramatically from 1990-2017, outpacing the use of the term diversity over that period. These results not only support Hypothesis 2, but this analysis also corroborates the work of Panofsky and Bliss (2017) with a larger sample, over a longer period of time, and in a more diverse set of publication sources. 