---
title: "Examining the Growth of Diversity-Related Terminology in Scientific Abstracts"
author: "Brandon L. Kramer (University of Virginia, Biocomplexity Institute) & Catherine Lee (Rutgers, Sociology)"
output: html_document 
---


In this project, we are examining the growth of in the use of the term "diversity". To do this, we drew from the MEDLINE database in Web of Science, using the search terms "TS=(diversity)" from 1990-2017 for human research only. This search provided 71,528 total results, which we extracted using the bibliometrix package in R. Next, we converted the abstracts of these articles to a text corpus and then used tidytext - a package designed for computational text analysis in R - to analyze patterns with the abstracts of these data. Below is the R Markdown file and replication code for these analyses.

```{r setup, include = FALSE}
rm(list = ls())
#knitr::opts_knit$set(root.dir = "~/Desktop/Brandon Kramer/Diversity/2019_0813")
knitr::opts_knit$set(root.dir = "C:/Users/bkram/CloudStation/Diversity Project/Data")
for (pkg in c("tidyverse", "igraph", "tidytext", "ggplot2", "ggraph", "widyr", "plotly", "stringi", "networkD3")) {library(pkg, character.only = TRUE)}
```

## Examining Growth of Published Studies 

In this first chunk, we load our data and examine the overall growth of articles from our search query. As we can see, there is a pretty sizable growth in scientific literature that uses the term diversity - from about 500 times in 1990 to over 5000 in 2017.  

```{r, message = FALSE, results = FALSE}
# loading the .csv file 
text_data <- read_csv("historical_text_data.csv")
```
```{r wos study growth, fig.width=9.5}
# checking to see how the overall data looks 
by_year <- text_data %>% 
  filter(year != "2018") %>% # filtering 2018 articles because they seem to be incomplete
  group_by(year) %>% count(year, sort = TRUE) %>% ungroup()
by_year <- ggplot() + geom_line(aes(y = n, x = year), data = by_year, stat="identity") + 
  labs(title = "Growth in Diversity-Related Publications from 1990-2017",
       caption = "Data Source: Web of Science") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank())
by_year <- ggplotly(by_year); by_year
```

## Word Frequencies Over Time

Next, we want to look at word frequencies by year in the literature. This chunk of code breaks down how common words occur in the abstracts of our dataset. Note that we also remove some frequently occurring words that are not really relevant to our dataset, but these do not systematically alter our results. 

```{r wos abstract text analysis, messages = FALSE, warning=FALSE}
# tokenizing the abstract data into words 
abstract_data <- text_data %>% 
  unnest_tokens(word, abstract) %>% 
  anti_join(stop_words)

# most frequent word count in abstracts 
abstract_data %>%
  count(word, sort = TRUE)
```
```{r wos abstract text analysis part 3, messages = FALSE, warning=FALSE, results = FALSE}
# adding custom set of stopwords 
my_stopwords <- tibble(word = c(as.character(1:9), 
                                "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", 
                                "rights", "reserved", "copyright", "elsevier"))
abstract_data <- abstract_data %>% anti_join(my_stopwords)
```
```{r wos abstract text analysis part 4, messages = FALSE, warning=FALSE}
# looking at word frequencies by year 
abstract_words <- abstract_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(word, sort = TRUE) %>% ungroup(); abstract_words
```

## Growth in Population-Specific Terms Over Time

Now, we want to look at how the most relevant words vary over time. Brandon chose to include words like diversity, genetic, and population as well as racially-specific and ethnically-specific terms. As we see, the rise of diversity does not necessarily mean that the focus on race or ethnicity is growing in congruence with that term. This could mean that diversity is being used as a catch-all in the scientific literature (i.e. that the multiplicity of the term makes it mean anything and everything) or that diversity is most used in fields like immunology or oncology. We will explore that hypothesis a bit more below. 

```{r examining top diversity related words over time, fig.width=9.5}
diversity_terms <- abstract_words %>% 
  filter(year != "2018") %>%
  filter(word == "diversity" |  word == 'genetic' | word == "population" |
         word == "ethnic" | word == "racial" | word == 'race' | 
         word == 'caucasian' | word == 'african' | word == 'black') 
diversity_terms

word_graph <- ggplot() + geom_line(aes(y = n, x = year, colour = word),
                     data = diversity_terms, stat="identity") + 
  labs(title = "Growth in Diversity-Related Terms (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

interactive_graph <- ggplotly(word_graph); interactive_graph
```

While that was quite useful, we do not see much variation in how race/ethinicity vary over time. One possibility is that variation in those terms is "diluted" by the various terms that researchers use. Thus, the next logical step is to collapse all of the population-specific terms into one category and compare that to other terminology over time. Both Lee (2009) and Kramer (2019) as well as others (e.g. Panofsky and Bliss 2017) have found that biomedical researchers continue to use population-specific terminology to reinforce the notion of population differences in various biological markers. Below, we have collapsed several population-specific terms into one category based. [This list of terms](https://docs.google.com/spreadsheets/d/1Gs-aSgXlnwo8rP3wnpMB0kdrU_VS76aDT3DCiI8OmVU/edit#gid=0) which were developed out of Kramer's (2019) dissertation work. While we won't claim that this is an exhaustive list of all the population terms that exist in the world, it is a fairly comprehensive list of over 2,100 terms (also see below in text networks section). Let's take a look how much the use of all these population-specific terms grew over time... 

```{r collapsing population specific terms part 1, message = FALSE, results = FALSE}
population_specific <- read_csv("population_terms.csv") 
```

```{r collapsing population specific terms part 2, fig.width=9.5}

population_specific <- paste(c("\\b(?i)(zcx", population_specific$term, "zxc)\\b"), collapse = "|")

recoded_abstract_data <- abstract_data %>% 
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = population_specific), 
                               yes = "population-specific", no = word))

recoded_abstract_data %>% filter(recoded_word == "population-specific")

recoded_abstract_words <- recoded_abstract_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(recoded_word, sort = TRUE) %>% ungroup(); recoded_abstract_words

diversity_terms <- recoded_abstract_words %>% 
  filter(recoded_word == "diversity" | recoded_word == "genetic" | 
         recoded_word == "population" | recoded_word == "population-specific") 
diversity_terms

word_graph <- ggplot() + geom_line(aes(y = n, x = year, colour = recoded_word),
                     data = diversity_terms, stat="identity") + 
  labs(title = "Growth in Diversity-Related Terminology (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

interactive_graph <- ggplotly(word_graph); interactive_graph
```

Interesting! After we collapsed all of the terms together in the population-specific category, we see a dramatic growth that goes well beyond the growth in diversity. Now, let's see what the growth of these terms look like when we break it down by general, national, continential, and ethnic groups across various geographies. 

```{r breaking apart those population specific terms part 1, message = FALSE, warning = FALSE, fig.width=9.5}

general_pop_terms <- read_csv("population_terms.csv") %>% filter(sub_category == "population_general")
us_specific_terms <- read_csv("population_terms.csv") %>% filter(sub_category == "us_specific")
continental_terms <- read_csv("population_terms.csv") %>% 
  filter(category == "continental" | category == "subcontinental")
ling_religious_terms <- read_csv("population_terms.csv") %>% filter(category == "linguistic_religious")
national_terms <- read_csv("population_terms.csv") %>% filter(category == "national")
south_american_ethnic_groups <- read_csv("population_terms.csv") %>% filter(category == "south_america")
african_ethnic_groups <- read_csv("population_terms.csv") %>% filter(category == "africa")
north_american_ethnic_groups <- read_csv("population_terms.csv") %>% filter(category == "north_america")
european_ethnic_groups <- read_csv("population_terms.csv") %>% filter(category == "europe")
asian_ethnic_groups <- read_csv("population_terms.csv") %>% filter(category == "asia")
all_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "south_america" | category == "africa" | 
           category == "asia" | category == "north_america" | category == "europe")
```

```{r breaking apart those population specific terms part 2, fig.width=9.5}
general_pop_terms <- paste(c("\\b(?i)(zxz", general_pop_terms$term, "zxz)\\b"), collapse = "|")
us_specific_terms <- paste(c("\\b(?i)(zxz", us_specific_terms$term, "zxz)\\b"), collapse = "|")
continental_terms <- paste(c("\\b(?i)(zxz", continental_terms$term, "zxz)\\b"), collapse = "|")
ling_religious_terms <- paste(c("\\b(?i)(zxz", ling_religious_terms$term, "zxz)\\b"), collapse = "|")
national_terms <- paste(c("\\b(?i)(zxz", national_terms$term, "zxz)\\b"), collapse = "|")
south_american_ethnic_groups <- paste(c("\\b(?i)(zxz", south_american_ethnic_groups$term, "zxz)\\b"), collapse = "|")
african_ethnic_groups <- paste(c("\\b(?i)(zxz", african_ethnic_groups$term, "zxz)\\b"), collapse = "|")
north_american_ethnic_groups <- paste(c("\\b(?i)(zxz", north_american_ethnic_groups$term, "zxz)\\b"), collapse = "|")
european_ethnic_groups <- paste(c("\\b(?i)(zxz", european_ethnic_groups$term, "zxz)\\b"), collapse = "|")
asian_ethnic_groups <- paste(c("\\b(?i)(zxz", asian_ethnic_groups$term, "zxz)\\b"), collapse = "|")
all_ethnic_groups <- paste(c("\\b(?i)(zxz", all_ethnic_groups$term, "zxz)\\b"), collapse = "|")

recoded_abstract_data <- abstract_data %>% 
  
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = general_pop_terms), 
                               yes = "general population terms", no = word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = us_specific_terms), 
                               yes = "us-specific terms", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = continental_terms), 
                               yes = "continental terms", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = ling_religious_terms), 
                               yes = "linguistic & religious terms", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = national_terms), 
                               yes = "national terms", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = south_american_ethnic_groups), 
                               yes = "south american ethnic groups", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = african_ethnic_groups), 
                               yes = "african ethnic groups", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = north_american_ethnic_groups), 
                               yes = "north american ethnic groups", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = european_ethnic_groups), 
                               yes = "european ethnic groups", no = recoded_word)) %>%
  mutate(recoded_word = ifelse(test = str_detect(string = abstract_data$word, pattern = asian_ethnic_groups), 
                               yes = "asian ethnic groups", no = recoded_word))  

recoded_abstract_words <- recoded_abstract_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(recoded_word, sort = TRUE) %>% ungroup(); recoded_abstract_words

diversity_terms <- recoded_abstract_words %>% 
  filter(recoded_word == "diversity" | recoded_word == "population" | recoded_word == "population-specific" |
         recoded_word == "general population terms" | recoded_word == "continental terms" | recoded_word == "linguistic & religious terms" | 
         recoded_word == "national terms" | recoded_word == "south american ethnic groups" | recoded_word == "african ethnic groups" |
         recoded_word == "north american ethnic groups" | recoded_word == "european ethnic groups" | recoded_word == "asian ethnic groups" |
         recoded_word == "us-specific terms") 
diversity_terms

word_graph <- ggplot() + geom_line(aes(y = n, x = year, colour = recoded_word),
                     data = diversity_terms, stat="identity") + 
  labs(title = "Growth in Diversity-Related Terminology (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

interactive_graph <- ggplotly(word_graph); interactive_graph
```

As we can see here, the majority of growth in population-specific terms is because of an increased proclivity to mention nationalities (e.g. Italian or Japanese), continental terms (e.g. africa, asia, north america), and general population terms (e.g. race, ethnicity, caucasian, african, asian, etc). We do not really see much growth in ethnic groups in any given continent even when we lump all of the different ethnic groups into one category (not shown here). 

## Text Networks of Diversity-Related Studies

We were also interested in the terms that most commonly occured alongside diversity. We can do this by running pairwise counts across the abstracts and then using network analysis to map what those relationships look like. In the graph presented below, the nodes correspond to commonly occuring words in our abstract dataset with the strength of the lines between the nodes aligning with the frequency those words arise in the same abstract. 

```{r co-occurence networks of diversity abstracts part 1, message = FALSE, warning = FALSE, fig.width=9.5}

all_population_terms <- read_csv("population_terms.csv")
```

Here is that massive list of population terms we mentioned above. Keep in mind that when we searched through our corpus, we ignored cases so don't mind the variation in capitalization here. 

```{r co-occurence networks of diversity abstracts part 2, fig.width=9.5, fig.height=7}
all_population_terms <- paste(c("\\b(?i)(zxz", all_population_terms$term, "zxz)\\b"), collapse = "|")
all_population_terms

filtered_pairs <- abstract_data %>%
  filter(str_detect(word, all_population_terms)) %>% 
  pairwise_count(word, id, sort = TRUE, upper = FALSE) %>% 
  filter(n >= 80)

# network visualization of most frequent pairs 
set.seed(1234)
filtered_pairs %>%
    filter(n >= 80) %>%   # may need to alter this number for a cutoff point 
    graph_from_data_frame() %>%
    ggraph(layout = "fr") +
    geom_edge_link(aes(edge_alpha = n, edge_width = n), edge_colour = "cyan4") +
    geom_node_point(size = 3) +
    geom_node_text(aes(label = name), repel = TRUE, 
                   point.padding = unit(0.2, "lines")) + theme_void()

```

This network is composed of nodes (corresponding to poppulation-specific words in our corpus) and ties (representing how many times they co-occur in the same abstracts of our dataset). As you can see in the graph, there is a core that forms with the most commonly occuring words in the corpus. Below, I have made the same network interactive using the networkD3 package. This allows you to hover over each node (or word) and see which other words it is connected to in the network. 

```{r interactive co-occurence networks of diversity abstracts, fig.width=9.5, fig.height=7}
links <- filtered_pairs %>% 
  rename(from = item1, to = item2, weight = n)

simpleNetwork(links,  fontSize = 20,  linkDistance = 200, 
              opacity = 0.8, width = 12, fontFamily = "sans-serif", charge = -20, zoom = TRUE)
```

We can also use an algorithm that breaks networks into neighborhoods of words that share the most frequeny co-occurrences. Here, the same network is visualized, but this time the colors correspond to different clusters (measured using the modularity function in igraph). This helps see the clustering of words in the network after the less frequent words are filtered out (i.e. those occurring less than 80 times).

```{r interactive co-occurence networks of diversity abstracts with modularity, fig.width=9.5, fig.height=7}
word_graph <- graph.data.frame(links, directed = FALSE)
wc <- cluster_walktrap(word_graph)
members <- membership(wc)
words_d3 <- igraph_to_networkD3(word_graph, group = members, what = "both")

forceNetwork(Links = words_d3$links, Nodes = words_d3$nodes, 
             Source = 'source', Target = 'target', NodeID = 'name', Group = 'group',
             fontSize = 25,  linkDistance = 100, opacity = 0.8, 
             fontFamily = "sans-serif", charge = -15, zoom = TRUE)
```

## Examining Diversity Across Different Geographies

The next step is to look at how the concept of "diversity" is used across the world. As the graph below demonstrates, the rise of "diversity" seems mostly to grow in the context of predominantly White, Westernized countries like US, England, the Netherlands, Germany and Switzerland. 

```{r breaking down annual growth of diversity by country, fig.width=9.5}
# here we are just converting everything to lower case 
abstract_data$country <- tolower(abstract_data$country)

# looking at word frequencies by year 
diversity_by_country <- abstract_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(word, country, sort = TRUE) %>% ungroup(); diversity_by_country

diversity_by_country <- diversity_by_country %>% 
  filter(word == "diversity") 
diversity_by_country

diversity_over_time <- ggplot() + geom_line(aes(y = n, x = year, colour = country),
                     data = diversity_by_country, stat="identity") +
  labs(title = "Growth in Diversity-Related Terminology (From 1990-2017, By Country)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

diversity_over_time <- ggplotly(diversity_over_time); diversity_over_time
```

## Examining Diversity Across Different Academic Disciplines 

Lastly, we wanted to look more into the growth of diversity related terms by scientific subject matter. This snippet of code breaks down the number of words occuring in abstracts over time, which is then broken down by MEDLINE's and Web of Science's subject categories. I have opted to only include 12 of the 150 different categories that could have been graphed here. Overall, we see that the rise of diversity in genetics & heredity, biochemistry & molecular biology, microbiology, immunology, and infectious disease research. We do not see this same rise in the social sciences, though there admittedly is some overall growth in that domain. 

```{r breaking down annual growth of diversity by subject, message = FALSE, warning = FALSE, fig.width=9.5}

# first we need to break apart all the subject categories for each paper 
text_data <- text_data %>% 
  separate(subject, into = paste("subject", 1:15, sep = "_"), sep = ";") %>%
  gather(value, subject, subject_1:subject_15, na.rm = TRUE) %>% select(-value)

# and remove the annoying parentheticals from some categories
text_data <- text_data %>% 
  separate(subject, into = c("subject", "void"), sep = "[(]") %>% select(-void)

# then we git rid of the extra white space and make everything lower case to standardize 
text_data$subject <- stri_trim_both(text_data$subject)
text_data$subject <- tolower(text_data$subject)

# this shows us we have 134 different subjects and we appear to have removed all the duplicates 
unique(text_data$subject)
 
# now we can see how often these words arise by subject 
subject_data <- text_data %>% 
  unnest_tokens(word, abstract) %>% 
  anti_join(stop_words)

growth_by_subject <- subject_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(word, subject, sort = TRUE) %>% ungroup()  

subject_data %>% 
  count(subject, sort = TRUE)

graph_by_subject <- growth_by_subject %>% 
  filter(word == "diversity") %>% 
  filter(subject == "genetics & heredity" | subject == "biochemistry & molecular biology" | 
           subject == "microbiology" | subject == "infectious diseases" | subject == "immunology" | 
           subject == "pharmacology & pharmacy" | subject == "behavioral sciences" |
           subject == "health care sciences & services" | subject == "neurosciences & neurology" |
           subject == "psychology" | subject == "sociology" | 
           subject == "oncology" | subject == "business & economics"
         )

graph_by_subject <- ggplot() + geom_line(aes(y = n, x = year, colour = subject),
                     data = graph_by_subject, stat="identity") +
  labs(title = "Growth in Diversity-Related Terminology (From 1990-2017), By Subject)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

graph_by_subject <- ggplotly(graph_by_subject); graph_by_subject

```

Instead of selecting particular subjects, we also wanted to know what would happen if we just collapsed the categories into three buckets: (1) genetics & heredity (i.e. evolution, plant and animal sciences), (2) biomedical studies, and (3) the social and behavioral sciences. As a general side note, when one of the original categories did not fit into these three recoded categories (e.g. mathematics or computer science), they were just recoded as "other" and ignored in our final analysis. For a full list of how the original 134 categories were recoded, [you can visit this link](https://docs.google.com/spreadsheets/d/1Gs-aSgXlnwo8rP3wnpMB0kdrU_VS76aDT3DCiI8OmVU/edit#gid=849010328). 

```{r breaking down annual growth of diversity by recoded subject part 1, message = FALSE, warning = FALSE, fig.width=9.5}
genetics_heredity <- read_csv("subject_categories.csv") %>% filter(collapsed_subject == "genetics_heredity")
biomedical_studies <- read_csv("subject_categories.csv") %>% filter(collapsed_subject == "biomedical_studies")
social_behavioral <- read_csv("subject_categories.csv") %>% filter(collapsed_subject == "social_behavioral")
other_studies <- read_csv("subject_categories.csv") %>% filter(collapsed_subject == "other")
```


```{r breaking down annual growth of diversity by recoded subject part 2, fig.width=9.5}
genetics_heredity <- paste(c("\\b(?i)(zxz", genetics_heredity$original_subject, "zxz)\\b"), collapse = "|")
biomedical_studies <- paste(c("\\b(?i)(zxz", biomedical_studies$original_subject, "zxz)\\b"), collapse = "|")
social_behavioral <- paste(c("\\b(?i)(zxz", social_behavioral$original_subject, "zxz)\\b"), collapse = "|")
other_studies <- paste(c("\\b(?i)(zxz", other_studies$original_subject, "zxz)\\b"), collapse = "|")

recoded_subject_data <- subject_data %>% 
  select(subject, word, year) %>%
  mutate(recoded_subject = ifelse(test = str_detect(string = subject_data$subject, pattern = genetics_heredity), 
                               yes = "genetics & heredity", no = subject)) %>%
  mutate(recoded_subject = ifelse(test = str_detect(string = subject_data$subject, pattern = biomedical_studies), 
                               yes = "biomedical studies", no = recoded_subject)) %>%
  mutate(recoded_subject = ifelse(test = str_detect(string = subject_data$subject, pattern = social_behavioral), 
                               yes = "social & behavioral sciences", no = recoded_subject)) %>% 
  mutate(recoded_subject = ifelse(test = str_detect(string = subject_data$subject, pattern = other_studies), 
                               yes = "other subjects", no = recoded_subject))

growth_by_subject <- recoded_subject_data %>%
  filter(year != "2018") %>%
  group_by(year) %>% 
  count(word, recoded_subject, sort = TRUE) %>% ungroup()

graph_by_subject <- growth_by_subject %>% 
  filter(word == "diversity") 

graph_by_subject <- ggplot() + geom_line(aes(y = n, x = year, colour = recoded_subject),
                     data = graph_by_subject, stat="identity") +
  labs(title = "Growth in Diversity-Related Terminology (From 1990-2017), By Subject") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), legend.title = element_blank())

interactive_by_subject <- ggplotly(graph_by_subject); interactive_by_subject

```

Perhaps this is just a by-product of more categories being biomedically-related, but this analysis clearly shows that diversity seems to be growing faster in biomedical studies than in the social & behavioral sciences and genetics & heredity-related studies. 

## Conclusion 

Overall, this document shows a rise in the use of "diversity" across scientific research. We see a 10-fold increase across the 1990s and 2000's, which mostly occurs in research deriving from Westernized biomedical scientific contexts. Our future analyses will examine more what implications this has for the use of diversity in and outside of that domain. 

## References 

Kramer, B. L. (2019). *Molecularization at the intersections: testosterone, prostate cancer and the construction of racial difference.* Doctoral dissertation, Rutgers University-School of Graduate Studies.

Lee, C. (2009). “Race” and “ethnicity” in biomedical research: how do scientists construct and explain differences in health?. *Social Science & Medicine*, 68(6), 1183-1190.

Panofsky, A., & Bliss, C. (2017). Ambiguity and scientific authority: population classification in genomic science. *American Sociological Review*, 82(1), 59-87.



