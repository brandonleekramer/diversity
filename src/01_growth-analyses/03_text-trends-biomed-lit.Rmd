---
title: "The Growth of Diversity"
author: "Brandon L. Kramer (UVA, Biocomplexity Institute) & Catherine Lee (Rutgers, Sociology)"
output: html_document 
---

### Data Ingestion

```{r setup, include = FALSE}
rm(list = ls())
#knitr::opts_knit$set(root.dir = "~/Documents/Diversity/Data")
knitr::opts_knit$set(root.dir = "C:/Users/bkram/CloudStation/Diversity/Data")
```

### Overall Growth of Publications 

```{r load packages, message = FALSE, results = FALSE, echo=FALSE}
# loading packages 
for (pkg in c("tidyverse", "igraph", "tidytext", "ggplot2", "ggraph", "widyr", "plotly", "stringi", "networkD3")) {library(pkg, character.only = TRUE)}
# loading the .csv file 

text_data <- read_csv("biomedical_corpus.csv") %>% 
  rowid_to_column(var = "id") %>% 
  rename(authors = AU, title = TI, publication = SO, #author_keywords = DE,
         abstract = AB, references = CR, year = PY, times_cited = TC) %>% 
  select(id, authors, title, year, publication, abstract, references, year, times_cited) %>% 
# filtering 2018 articles because they seem to be incomplete 
  filter(year != "2018") 
  
```
```{r wos study growth, fig.width=9.5, echo=FALSE}
# checking to see how the overall data looks 
text_data %>% 
  group_by(year) %>% 
  count(year, sort = TRUE) %>% 
  arrange(year)

pubs_by_year <- text_data %>% 
  group_by(year) %>% count(year, sort = TRUE) %>% ungroup() %>% 
  ggplot() + geom_line(aes(y = n, x = year), stat="identity") + 
  labs(title = "Figure 1. Growth in Diversity-Related Publications from 1990-2017",
       caption = "Data Source: Web of Science") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank()); ggplotly()
```

### Word Frequencies Over Time

```{r text analysis of abstracts, messages = FALSE, warning=FALSE, echo=FALSE}
# tokenizing the abstract data into words 
abstract_data <- text_data %>% 
  unnest_tokens(word, abstract) %>% 
  anti_join(stop_words) %>% 
  drop_na(word)
# adding custom set of stopwords 
my_stopwords <- tibble(word = c(as.character(1:14), "[0-9]",
                                "rights", "reserved", "copyright", "elsevier"))
abstract_data <- abstract_data %>% anti_join(my_stopwords); rm(my_stopwords)
# most frequent word count in abstracts 
abstract_data %>%
  count(word, sort = TRUE)
```

```{r abstract word count, messages = FALSE, warning=FALSE, include=FALSE}
# looking at word frequencies by year 
abstract_data %>%
  group_by(year) %>% 
  count(word, sort = TRUE) %>% ungroup()
```

### Growth in General Population Terms Over Time

```{r figure 2a, fig.width=9.5, echo=FALSE}
# recoding race*, ethnicity* and cultural* terminology
general_pop_terms <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(race|racial|racially)\\b"), 
                       yes = "racial*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(ethnic|ethnicity|ethnically)\\b"), 
                       yes = "ethnic*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(culture|cultural|culturally)\\b"), 
                       yes = "cultural*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern =
  "\\b(?i)(ancestry|ancestries|ancestral|ancestor|ancestors|descent|descendent|descendents)\\b"), 
                       yes = "ancestry*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, pattern = "\\b(?i)(man|men|male|males|boy|boys|woman|women|female|females|girl|girls|XX|XY|XXY|sex|sexes|gender|genders|sexed|gendered|transgender|transgendered|transsexual|transsexuals|maletofemale|femaletomale)\\b"), yes = "sex/gender", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, pattern = "\\b(?i)(sexuality|sexualities|homosexual|homosexuals|homosexuality|heterosexual|heterosexuals|heterosexuality|bisexual|bisexuality|monogamous|monogamy|polygamous|polygamy|polygyny|polygynous|lgb|lgbt|lgbtq|lesbian|lesbians|gay|gays|queer|queers)\\b"), yes = "sexuality", no = term)) %>%
# grouping by year and filter relevant population terms 
  group_by(year) %>% count(term, sort = TRUE) %>% ungroup() %>% 
  filter(term == "diversity" | term == "cultural*" | term == "genetic" | term == "population*" | 
           term == "racial*" | term == "ethnic*" | term == "ancestry*" | 
           term == "sex/gender" | term == "sexuality") %>% 
# graphing terms over time 
  ggplot() + geom_line(aes(y = n, x = year, colour = term), stat="identity") + 
  labs(title = "Figure 2A. Growth in General Diversity-Related Terms (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

```{r figure 2b, fig.width=9.5, echo=FALSE}
# recoding race*, ethnicity* and cultural* terminology
general_pop_terms <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(race|racial|racially)\\b"), 
                       yes = "racial*", no = word)) %>% 
  mutate(di_racial = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(racial*)\\b"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(ethnic|ethnicity|ethnically)\\b"), 
                       yes = "ethnic*", no = term)) %>% 
  mutate(di_ethnic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(ethnic*)\\b"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(culture|cultural|culturally)\\b"), 
                       yes = "cultural*", no = term)) %>% 
  mutate(di_cultural = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(cultural*)\\b"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = term)) %>% 
  mutate(di_population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(population*)\\b"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern =
  "\\b(?i)(ancestry|ancestries|ancestral|ancestor|ancestors|descent|descendent|descendents)\\b"), 
                       yes = "ancestry*", no = term)) %>% 
  mutate(di_ancestry = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(ancestry*)\\b"), yes = 1, no = 0)) %>% 
  mutate(di_diversity = ifelse(test = str_detect(string = term, 
                       pattern = "diversity"), yes = 1, no = 0)) %>% 
  mutate(di_genetic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(genetic)\\b"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, pattern = "\\b(?i)(man|men|male|males|boy|boys|woman|women|female|females|girl|girls|XX|XY|XXY|sex|sexes|gender|genders|sexed|gendered|transgender|transgendered|transsexual|transsexuals|maletofemale|femaletomale)\\b"), yes = "sex/gender", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, pattern = "\\b(?i)(sexuality|sexualities|homosexual|homosexuals|homosexuality|heterosexual|heterosexuals|heterosexuality|bisexual|bisexuality|monogamous|monogamy|polygamous|polygamy|lgb|lgbt|lgbtq|lesbian|lesbians|gay|gays|queer|queers)\\b"), yes = "sexuality", no = term)) %>%
  mutate(di_sexgender = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sex/gender)\\b"), yes = 1, no = 0)) %>%
  mutate(di_sexuality = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(sexuality)\\b"), yes = 1, no = 0))

# total articles each year 
gen_pop_prc_counts <- text_data %>% 
  group_by(year) %>% 
  count(year) %>% 
  ungroup() %>% 
  rename(total = n) 
# articles with term mentioned each year 
gen_pop_prc_counts <- general_pop_terms %>% 
  filter(di_racial == 1) %>% group_by(year) %>% 
  summarise(cnt_racial = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>%  
  mutate(prc_racial = round(cnt_racial / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_ethnic == 1) %>% 
  group_by(year) %>% summarise(cnt_ethnic = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_ethnic = round(cnt_ethnic / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_cultural == 1) %>% 
  group_by(year) %>% summarise(cnt_cultural = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_cultural = round(cnt_cultural / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_population == 1) %>% 
  group_by(year) %>% summarise(cnt_population = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_ancestry == 1) %>% 
  group_by(year) %>% summarise(cnt_ancestry = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_ancestry = round(cnt_ancestry / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_diversity == 1) %>% 
  group_by(year) %>% summarise(cnt_diversity = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_diversity = round(cnt_diversity / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_genetic == 1) %>% 
  group_by(year) %>% summarise(cnt_genetic = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_genetic = round(cnt_genetic / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_sexgender == 1) %>% 
  group_by(year) %>% summarise(cnt_sexgender = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_sexgender = round(cnt_sexgender / total * 100, digits = 2))
gen_pop_prc_counts <- general_pop_terms %>% filter(di_sexuality == 1) %>% 
  group_by(year) %>% summarise(cnt_sexuality = n_distinct(id)) %>% 
  right_join(gen_pop_prc_counts, by = "year") %>% 
  mutate(prc_sexuality = round(cnt_sexuality / total * 100, digits = 2))

# graphing terms over time 
gen_pop_prc_counts <- gen_pop_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_ancestry, x = year, colour = "ancestry*"), stat="identity") +
  geom_line(aes(y = prc_cultural, x = year, colour = "cultural*"), stat="identity") +
  geom_line(aes(y = prc_diversity, x = year, colour = "diversity"), stat="identity") +
  geom_line(aes(y = prc_ethnic, x = year, colour = "ethnic*"), stat="identity") +
  geom_line(aes(y = prc_genetic, x = year, colour = "genetic"), stat="identity") +
  geom_line(aes(y = prc_population, x = year, colour = "population*"), stat="identity") +
  geom_line(aes(y = prc_racial, x = year, colour = "racial*"), stat="identity") +
  geom_line(aes(y = prc_sexgender, x = year, colour = "sex/gender"), stat="identity") +
  geom_line(aes(y = prc_sexuality, x = year, colour = "sexuality"), stat="identity") +
  labs(title = "Figure 2B. Proportional Growth in General Diversity-Related Terms (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly() 
```

```{r figure 3a, fig.width=9.5, echo=FALSE}
# first we need to recode variations of us-specific words (an alternative to stemming) 
us_pop_counts <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word,
                       pattern = "\\b(?i)(caucasian|caucasians)\\b"), yes = "caucasian", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(americans)\\b"), yes = "american", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(hispanics)\\b"), yes = "hispanic", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(indians)\\b"), yes = "indian", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(islanders)\\b"), yes = "islander", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(alaska|alaskans)\\b"), yes = "alaskan", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(hawaii|hawaiians)\\b"), yes = "hawaiian", no = term)) %>%
  select(-word) %>% rename(word = term) %>% 
# create a bigram of us-specific words 
  unnest_tokens(bigram, word, token = "ngrams", n = 2) %>% 
  separate(bigram, c("word1", "word2"), sep = " ") %>%          
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>% 
# unite the birgrams together with a hyphen
  unite(word, word1, word2, sep = "-") %>% 
  filter(word == "african-american" | word == "mexican-american" |
         word == "american-indian" | word == "native-american" | 
         word == "alaskan-native" | word == "native-hawaiian" | 
         word == "pacific-islander" | word == "racial*" | word == "ethnic*" ) %>% 
  count(word, year, sort = TRUE) 
# combining the hyphenated words to our full dataset 
us_pop_counts <- abstract_data %>% 
  group_by(year) %>% count(word, sort = TRUE) %>% ungroup() %>% 
  select(word, year, n) %>% bind_rows(us_pop_counts) 
# graphing us-specific terms over time 
us_pop_terms <- us_pop_counts %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word,
                       pattern = "\\b(?i)(black|blacks|african-american)\\b"), 
                       yes = "black*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(white|caucasian-american)\\b"), 
                       yes = "white*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(hispanic|mexican-american)\\b"), 
                       yes = "hispanic*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(native-american|american-indian|alaskan-native)\\b"), 
                       yes = "native-american*", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(pacific-islander|native-hawaiian)\\b"), 
                       yes = "pacific-islander*", no = term)) %>%   
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(race|racial|racially)\\b"), 
                       yes = "racial*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(ethnic|ethnicity|ethnically)\\b"), 
                       yes = "ethnic*", no = term)) %>% 
  filter(term == "black*" | term == "white*" | term == "hispanic*" | 
         term == "native-american*" | term == "pacific-islander*" | 
         term == "diversity" | term == "racial*" | term == "ethnic*") %>%  
  group_by(term, year) %>% summarise(n = sum(n)) %>% arrange(-n) %>% 
  ggplot() + geom_line(aes(y = n, x = year, colour = term), stat="identity") + 
  labs(title = "Figure 3A. Growth in US-Specific Diversity-Related Terms (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

```{r figure 3b, fig.width=9.5, echo=FALSE}
# first we need to recode variations of us-specific words (an alternative to stemming) 
us_pop_counts <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word,
                       pattern = "\\b(?i)(caucasian|caucasians)\\b"), yes = "caucasian", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(americans)\\b"), yes = "american", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(hispanics)\\b"), yes = "hispanic", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(indians)\\b"), yes = "indian", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(islanders)\\b"), yes = "islander", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(alaska|alaskans)\\b"), yes = "alaskan", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(hawaii|hawaiians)\\b"), yes = "hawaiian", no = term)) %>%
  select(-word) %>% rename(word = term) %>% 
# create a bigram of us-specific words 
  unnest_tokens(bigram, word, token = "ngrams", n = 2) %>% 
  separate(bigram, c("word1", "word2"), sep = " ") %>%          
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>% 
# unite the birgrams together with a hyphen
  unite(word, word1, word2, sep = "-") %>% 
  filter(word == "african-american" | word == "mexican-american" |
         word == "american-indian" | word == "native-american" | 
         word == "alaskan-native" | word == "native-hawaiian" | 
         word == "pacific-islander" | word == "racial*" | word == "ethnic*" ) %>% 
  count(word, id, year, sort = TRUE) 
# combining the hyphenated words to our full dataset 
us_pop_counts <- abstract_data %>% 
  group_by(year) %>% count(word, id, sort = TRUE) %>% ungroup() %>% 
  select(word, id, year, n) %>% bind_rows(us_pop_counts) 
# graphing us-specific terms over time 
us_pop_counts <- us_pop_counts %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word,
                       pattern = "\\b(?i)(black|blacks|african-american)\\b"), 
                       yes = "black*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(white|caucasian-american)\\b"), 
                       yes = "white*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(hispanic|mexican-american)\\b"), 
                       yes = "hispanic*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(native-american|american-indian|alaskan-native)\\b"), 
                       yes = "native-american*", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(pacific-islander|native-hawaiian)\\b"), 
                       yes = "pacific-islander*", no = term)) %>%   
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(race|racial|racially)\\b"), 
                       yes = "racial*", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = us_pop_counts$word, 
                       pattern = "\\b(?i)(ethnic|ethnicity|ethnically)\\b"), 
                       yes = "ethnic*", no = term)) %>% 
  mutate(black = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(black*)\\b"), yes = 1, no = 0)) %>% 
  mutate(white = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(white*)\\b"), yes = 1, no = 0)) %>% 
  mutate(hispanic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(hispanic*)\\b"), yes = 1, no = 0)) %>% 
  mutate(native_american = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(native-american*)\\b"), yes = 1, no = 0)) %>% 
  mutate(pacific_islander = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(pacific-islander*)\\b"), yes = 1, no = 0)) %>% 
  mutate(racial = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(racial*)\\b"), yes = 1, no = 0)) %>% 
  mutate(ethnic = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(ethnic*)\\b"), yes = 1, no = 0))  

# total articles each year 
us_pop_prc_counts <- text_data %>% group_by(year) %>% 
  count(year) %>% ungroup() %>% rename(total = n) 
# articles with term mentioned each year 
us_pop_prc_counts <- us_pop_counts %>% filter(black == 1) %>% 
  group_by(year) %>% summarise(cnt_black = n_distinct(id)) %>% 
  left_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_black = round(cnt_black / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(white == 1) %>% 
  group_by(year) %>% summarise(cnt_white = n_distinct(id)) %>% 
  left_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_white = round(cnt_white / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(hispanic == 1) %>% 
  group_by(year) %>% summarise(cnt_hispanic = n_distinct(id)) %>% 
  right_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_hispanic = round(cnt_hispanic / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(native_american == 1) %>% 
  group_by(year) %>% summarise(cnt_native_american = n_distinct(id)) %>% 
  right_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_native_american = round(cnt_native_american / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(pacific_islander == 1) %>% 
  group_by(year) %>% summarise(cnt_pacific_islander = n_distinct(id)) %>% 
  right_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_pacific_islander = round(cnt_pacific_islander / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(racial == 1) %>% 
  group_by(year) %>% summarise(cnt_racial = n_distinct(id)) %>% 
  right_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_racial = round(cnt_racial / total * 100, digits = 2))
us_pop_prc_counts <- us_pop_counts %>% filter(ethnic == 1) %>% 
  group_by(year) %>% summarise(cnt_ethnic = n_distinct(id)) %>% 
  right_join(us_pop_prc_counts, by = "year") %>% 
  mutate(prc_ethnic = round(cnt_ethnic / total * 100, digits = 2))

# graphing terms over time 
us_pop_prc_counts <- us_pop_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_black, x = year, colour = "black*"), stat="identity") +
  geom_line(aes(y = prc_white, x = year, colour = "white*"), stat="identity") +
  geom_line(aes(y = prc_hispanic, x = year, colour = "hispanic*"), stat="identity") +
  geom_line(aes(y = prc_native_american, x = year, colour = "native-american*"), stat="identity") +
  geom_line(aes(y = prc_pacific_islander, x = year, colour = "pacific-islander*"), stat="identity") +
  geom_line(aes(y = prc_ethnic, x = year, colour = "ethnic*"), stat="identity") +
  geom_line(aes(y = prc_racial, x = year, colour = "racial*"), stat="identity") +
  labs(title = "Figure 3B. Growth in US-Specific Diversity Terms, By Percentage (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly() 
```

### The Multiplicity of Population Terminology

```{r collapsing population specific terms, message = FALSE, results = FALSE, warning = FALSE, echo=FALSE}
# pulling our list of population
all_pop_terms <- read_csv("population_terms.csv") 
all_pop_terms <- paste(c("\\b(?i)(zcx", all_pop_terms$term, "zxc)\\b"), collapse = "|")
```

```{r figure 4a, fig.width=9.5, echo=FALSE}
all_pop_terms_graph <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = all_pop_terms), 
                       yes = "all population terms", no = term)) %>% 
  group_by(year) %>% count(term, sort = TRUE) %>% ungroup() %>% 
  filter(term == "diversity" | term == "genetic" | 
         term == "population*" | term == "all population terms") %>% 
  ggplot() + geom_line(aes(y = n, x = year, colour = term), stat="identity") + 
  labs(title = "Figure 4A. Growth in Collapsed Diversity-Related Terminology (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

```{r figure 4b, fig.width=9.5, echo=FALSE}
all_pop_terms_trends <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = word)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = all_pop_terms), 
                       yes = "all population terms", no = term)) %>% 
  mutate(population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b((?<!all )population*)\\b"), yes = 1, no = 0)) %>% 
  mutate(all_pop_terms = ifelse(test = str_detect(string = term, 
                       pattern = "\\b(all population terms)\\b"), yes = 1, no = 0)) 
# total articles each year 
all_pop_prc_counts <- text_data %>% group_by(year) %>% 
  count(year) %>% ungroup() %>% rename(total = n) 
# articles with term mentioned each year 
all_pop_prc_counts <- all_pop_terms_trends %>% filter(population == 1) %>% 
  group_by(year) %>% summarise(cnt_population = n_distinct(id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2))
all_pop_prc_counts <- all_pop_terms_trends %>% filter(all_pop_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_all_pop = n_distinct(id)) %>% 
  right_join(all_pop_prc_counts, by = "year") %>% 
  mutate(prc_all_pop = round(cnt_all_pop / total * 100, digits = 2))
# graphing the patterns over time
all_pop_prc_counts <- all_pop_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_population, x = year, colour = "population*"), stat="identity") +
  geom_line(aes(y = prc_all_pop, x = year, colour = "all population terms"), stat="identity") + 
  labs(title = "Figure 4B. Growth in Collapsed Diversity Terminology, By Percentage (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

```{r breaking apart collapsed population terms, message = FALSE, warning = FALSE, echo=FALSE}
# pulling in concatenated population terms from our dataset 
general_pop_terms <- read_csv("population_terms.csv") %>% 
  filter(sub_category == "population_general")
us_specific_terms <- read_csv("population_terms.csv") %>% 
  filter(sub_category == "us_specific")
continental_terms <- read_csv("population_terms.csv") %>% 
  filter(category == "continental" | category == "subcontinental")
ling_religious_terms <- read_csv("population_terms.csv") %>% 
  filter(category == "linguistic_religious")
national_terms <- read_csv("population_terms.csv") %>% 
  filter(category == "national")
south_american_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "south_america")
african_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "africa")
north_american_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "north_america")
european_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "europe")
asian_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "asia")
all_ethnic_groups <- read_csv("population_terms.csv") %>% 
  filter(category == "south_america" | category == "africa" | category == "asia" | 
         category == "north_america" | category == "europe")
# creating detection string patterns for all the categories
general_pop_terms <- paste(c("\\b(?i)(zxz", 
                     general_pop_terms$term, "zxz)\\b"), collapse = "|")
us_specific_terms <- paste(c("\\b(?i)(zxz", 
                     us_specific_terms$term, "zxz)\\b"), collapse = "|")
continental_terms <- paste(c("\\b(?i)(zxz", 
                     continental_terms$term, "zxz)\\b"), collapse = "|")
ling_religious_terms <- paste(c("\\b(?i)(zxz", 
                     ling_religious_terms$term, "zxz)\\b"), collapse = "|")
national_terms <- paste(c("\\b(?i)(zxz", 
                     national_terms$term, "zxz)\\b"), collapse = "|")
south_american_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     south_american_ethnic_groups$term, "zxz)\\b"), collapse = "|")
african_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     african_ethnic_groups$term, "zxz)\\b"), collapse = "|")
north_american_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     north_american_ethnic_groups$term, "zxz)\\b"), collapse = "|")
european_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     european_ethnic_groups$term, "zxz)\\b"), collapse = "|")
asian_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     asian_ethnic_groups$term, "zxz)\\b"), collapse = "|")
all_ethnic_groups <- paste(c("\\b(?i)(zxz", 
                     all_ethnic_groups$term, "zxz)\\b"), collapse = "|")
```

```{r figure 5a, fig.width=9.5, echo=FALSE}
# graphing the population terms into various categories 
pop_terms_bycats <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = general_pop_terms), 
                       yes = "general population terms", no = word)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = us_specific_terms), 
                       yes = "us-specific terms", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = continental_terms), 
                       yes = "continental terms", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = ling_religious_terms), 
                       yes = "linguistic & religious terms", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = national_terms), 
                       yes = "national terms", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = south_american_ethnic_groups), 
                       yes = "south american ethnic groups", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = african_ethnic_groups), 
                       yes = "african ethnic groups", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = north_american_ethnic_groups), 
                       yes = "north american ethnic groups", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = european_ethnic_groups), 
                       yes = "european ethnic groups", no = term)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = asian_ethnic_groups), 
                       yes = "asian ethnic groups", no = term)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = term)) %>% 
  group_by(year) %>% count(term, sort = TRUE) %>% ungroup() %>% 
  filter(term == "diversity" | term == "population*" | 
         term == "general population terms" | term == "us-specific terms" |
         term == "continental terms" | term == "linguistic & religious terms" | 
         term == "national terms" | term == "south american ethnic groups" | 
         term == "african ethnic groups" | term == "north american ethnic groups" | 
         term == "european ethnic groups" | term == "asian ethnic groups" ) %>% 
  ggplot() + geom_line(aes(y = n, x = year, colour = term), stat="identity") + 
  labs(title = "Figure 5A. Growth in Diversity-Related Terminology by Category (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

```{r figure 5b, fig.width=9.5, echo=FALSE}
# graphing the population terms into various categories 
pop_terms_bycats <- abstract_data %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = general_pop_terms), 
                       yes = "general population terms", no = word)) %>%
  mutate(general_terms = ifelse(test = str_detect(string = term, 
                       pattern = "general population terms"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = us_specific_terms), 
                       yes = "us-specific terms", no = term)) %>%
  mutate(us_terms = ifelse(test = str_detect(string = term, 
                       pattern = "us-specific terms"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = continental_terms), 
                       yes = "continental terms", no = term)) %>%
  mutate(continental_terms = ifelse(test = str_detect(string = term, 
                       pattern = "continental terms"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = ling_religious_terms), 
                       yes = "linguistic & religious terms", no = term)) %>%
  mutate(ling_rel_terms = ifelse(test = str_detect(string = term, 
                       pattern = "linguistic & religious terms"), yes = 1, no = 0)) %>% 
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = national_terms), 
                       yes = "national terms", no = term)) %>%
  mutate(national_terms = ifelse(test = str_detect(string = term, 
                       pattern = "national terms"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = south_american_ethnic_groups), 
                       yes = "south american ethnic groups", no = term)) %>%
  mutate(south_american_terms = ifelse(test = str_detect(string = term, 
                       pattern = "south american ethnic groups"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = african_ethnic_groups), 
                       yes = "african ethnic groups", no = term)) %>%
  mutate(african_terms = ifelse(test = str_detect(string = term, 
                       pattern = "african ethnic groups"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = north_american_ethnic_groups), 
                       yes = "north american ethnic groups", no = term)) %>%
  mutate(north_american_terms = ifelse(test = str_detect(string = term, 
                       pattern = "north american ethnic groups"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = european_ethnic_groups), 
                       yes = "european ethnic groups", no = term)) %>%
  mutate(european_terms = ifelse(test = str_detect(string = term, 
                       pattern = "european ethnic groups"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = asian_ethnic_groups), 
                       yes = "asian ethnic groups", no = term)) %>% 
  mutate(asian_terms = ifelse(test = str_detect(string = term, 
                       pattern = "asian ethnic groups"), yes = 1, no = 0)) %>%
  mutate(term = ifelse(test = str_detect(string = abstract_data$word, 
                       pattern = "\\b(?i)(population|populations)\\b"), 
                       yes = "population*", no = term)) %>% 
  mutate(population = ifelse(test = str_detect(string = term, 
                       pattern = "\\b((?<!general )population*)\\b"), yes = 1, no = 0)) 

# total articles each year 
bycats_prc_counts <- text_data %>% group_by(year) %>% 
  count(year) %>% ungroup() %>% rename(total = n) 
# articles with term mentioned each year 
bycats_prc_counts <- pop_terms_bycats %>% filter(general_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_general_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_general_terms = round(cnt_general_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(us_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_us_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_us_terms = round(cnt_us_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(continental_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_continental_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_continental_terms = round(cnt_continental_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(ling_rel_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_ling_rel_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_ling_rel_terms = round(cnt_ling_rel_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(national_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_national_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_national_terms = round(cnt_national_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(south_american_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_south_american_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_south_american_terms = round(cnt_south_american_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(african_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_african_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_african_terms = round(cnt_african_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(north_american_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_north_american_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_north_american_terms = round(cnt_north_american_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(european_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_european_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_european_terms = round(cnt_european_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(asian_terms == 1) %>% 
  group_by(year) %>% summarise(cnt_asian_terms = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_asian_terms = round(cnt_asian_terms / total * 100, digits = 2))
bycats_prc_counts <- pop_terms_bycats %>% filter(population == 1) %>% 
  group_by(year) %>% summarise(cnt_population = n_distinct(id)) %>% 
  right_join(bycats_prc_counts, by = "year") %>% 
  mutate(prc_population = round(cnt_population / total * 100, digits = 2))

bycats_prc_counts <- bycats_prc_counts %>% ggplot() + 
  geom_line(aes(y = prc_general_terms, x = year, colour = "general population terms"), stat="identity") +
  geom_line(aes(y = prc_us_terms, x = year, colour = "us-specific terms"), stat="identity") +
  geom_line(aes(y = prc_continental_terms, x = year, colour = "continental terms"), stat="identity") +
  geom_line(aes(y = prc_ling_rel_terms, x = year, colour = "linguistic & religious terms"), stat="identity") +
  geom_line(aes(y = prc_national_terms, x = year, colour = "national terms"), stat="identity") +
  geom_line(aes(y = prc_south_american_terms, x = year, colour = "south american terms"), stat="identity") +
  geom_line(aes(y = prc_african_terms, x = year, colour = "african terms"), stat="identity") +
  geom_line(aes(y = prc_north_american_terms, x = year, colour = "north american terms"), stat="identity") +
  geom_line(aes(y = prc_european_terms, x = year, colour = "european terms"), stat="identity") +
  geom_line(aes(y = prc_asian_terms, x = year, colour = "asian terms"), stat="identity") +
  geom_line(aes(y = prc_population, x = year, colour = "population*"), stat="identity") +
  labs(title = "Figure 5B. Growth in Diversity-Related Terminology, By Category/Percentage (1990-2017)") + 
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(), 
        legend.title = element_blank()); ggplotly()
```

### References 

Aria, M., & Cuccurullo, C. (2017). bibliometrix: An R-tool for comprehensive science mapping analysis. *Journal of Informetrics*, 11(4), 959-975.

Epstein, S. (2008). *Inclusion: The Politics of Difference in Medical Research.* University of Chicago Press.

Kramer, B. (2019). *Molecularization at the Intersections: Testosterone, Prostate Cancer and the Construction of Racial Difference.* Doctoral dissertation, Rutgers University-School of Graduate Studies.

Lee, C. (2009). “Race” and “ethnicity” in biomedical research: How do scientists construct and explain differences in health?. *Social Science & Medicine*, 68(6), 1183-1190.

M'charek, A. (2013). Beyond fact or fiction: On the materiality of race in practice. *Cultural Anthropology*, 28(3), 420-442.

Oh, S. S., Galanter, J., Thakur, N., Pino-Yanes, M., Barcelo, N. E., White, M. J., et al. (2015). Diversity in clinical and biomedical research: A promise yet to be fulfilled. *PLoS Medicine*, 12(12), e1001918.

Panofsky, A., & Bliss, C. (2017). Ambiguity and scientific authority: Population classification in genomic science. *American Sociological Review*, 82(1), 59-87.

Silge, J., & Robinson, D. (2016). tidytext: Text Mining and Analysis Using Tidy Data Principles in R. *Journal of Open Source Software*, 1(3), 37.


